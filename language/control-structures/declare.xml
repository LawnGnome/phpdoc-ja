<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision: 1.1 $ -->
<!-- EN-Revision: 1.1 Maintainer: takagi Status: ready -->

<sect1 xml:id="control-structures.declare" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title><literal>declare</literal></title>
 <para>
  <literal>declare</literal> 命令は、あるコードブロックの中に
  実効命令をセットするために使用されます。<literal>declare</literal>
  の文法は他の制御構造と似ています。
  <informalexample>
   <programlisting>
<![CDATA[
declare (命令)
    文
]]>
   </programlisting>
  </informalexample>
 </para>
 <para>
    <literal>命令</literal>の箇所で、セットされた<literal>
    declare</literal>ブロックの挙動を指定することが出来ます。
    現在のところ、使用できる命令は <literal>ticks</literal>
    (<link linkend="control-structures.declare.ticks">
    ticks</link>に関しては以下を参照してください) と
    <literal>encoding</literal>
    (<link linkend="control-structures.declare.encoding">encoding</link>
    に関しては以下を参照ください) です。
 </para>
 <note>
  <simpara>
   encoding ディレクティブは PHP 5.3.0 で追加されました。
  </simpara>
 </note>
 <para>
  <literal>declare</literal>ブロックの<literal>文</literal>
  の実行のされ方や実行時にどのような作用が起こるかについては
  <literal>命令</literal>に何が指定されたかに依存します。
 </para>
 <para>
  <literal>declare</literal>構造はグローバルスコープしても使用され、
  それはそれ以降のコード上の全てにおいて影響します
  (しかし、<literal>declare</literal> を含むファイルがインクルードされた場合は、
  親ファイルにはその影響は及びません)。
  <informalexample>
   <programlisting role="php">
<![CDATA[
<?php
// 以下は同じ意味です

// こうすることもできますし、
declare(ticks=1) {
    // ここにすべてのスクリプトを書きます
}

// こうすることもできます
declare(ticks=1);
// ここにすべてのスクリプトを書きます
?>
]]>
   </programlisting>
  </informalexample>
 </para>

 <sect2 xml:id="control-structures.declare.ticks">
  <title>Ticks</title>
  <caution>
   <simpara>
    PHP 5.3.0 で tick は非推奨となりました。
    PHP 6.0.0 で削除される予定です。
   </simpara>
  </caution>
  <para>tickとは<literal>declare</literal>ブロックの実行中にパーサが
  <varname>N</varname>個の低レベル命令を実行するごとに
  発生するイベントのことです。<varname>N</varname>の値は
  <literal>declare</literal>ブロックの<literal>命令</literal>の箇所で
  <literal>ticks=N</literal>のように
  指定します。
 </para>
 <para>
  tickごとに発生させるイベントは<function>register_tick_function</function>
  を使用して指定します。詳細は以下の例を参照してください。1回のtickで
  複数のイベントが起こり得ることに注意してください。
 </para>
 <para>
  <example>
   <title>PHPのコードの一部をプロファイルする</title>
   <programlisting role="php">
<![CDATA[
<?php
// 呼び出されるとその時間を記録する関数
function profile($dump = FALSE)
{
    static $profile;

    // 格納されたプロファイルを返し、その値を削除します
    if ($dump) {
        $temp = $profile;
        unset($profile);
        return $temp;
    }

    $profile[] = microtime();
}

// tickハンドラを設定します
register_tick_function("profile");

// declareブロックの前で初期化します
profile();

// 2命令ごとにtickを投げるように設定し、ブロックを実行します
declare(ticks=2) {
    for ($x = 1; $x < 50; ++$x) {
        echo similar_text(md5($x), md5($x*$x)), "<br />;";
    }
}

// プロファイラに格納されたデータを表示します
print_r(profile(TRUE));
?>
]]>
   </programlisting>
  </example>
  この例では、'declare'ブロックのコード中で2個の低レベル
  命令が実行されるごとにその時間を記録してプロファイルを
  行っています。この情報はコードのあるセクションの中で
  遅い箇所を探すのに使用できます。この処理は他の手法でも
  使用できます。ticksを使用することで実装が簡単になる
  場合が多々あるのです。
 </para>
 <simpara>
  ticksはデバッグ、単純なマルチタスク処理、バックグラウンドI/Oや
  その他多くの処理を実装するのに便利です。
 </simpara>
 <simpara>
  <function>register_tick_function</function> および
  <function>unregister_tick_function</function> も参照ください。
 </simpara>
 </sect2>
 <sect2 xml:id="control-structures.declare.encoding">
  <title>Encoding</title>
  <para>
    スクリプトのエンコーディングをスクリプトごとに指定するには
    encoding ディレクティブを使用します。
  <example>
   <title>スクリプトのエンコーディングの宣言</title>
    <programlisting role="php">
<![CDATA[
<?php
declare(encoding='ISO-8859-1');
// ここにコードを書きます
?>
]]>
    </programlisting>
   </example>
  </para>

  <caution>
   <simpara>
    名前空間と組み合わせて使用する場合、使用できる形式は
    <literal>declare(encoding='...');</literal> のみです。<literal>...</literal>
    にエンコーディングを指定します。<literal>declare(encoding='...') {}</literal>
    は、名前空間と組み合わせるとパースエラーとなります。
   </simpara>
  </caution>
  <para>
   php を <literal>--enable-zend-multibyte</literal> つきでコンパイルしていない場合、
   PHP 5.3 では encoding 宣言は無視されます。
   PHP 6.0 では、<literal>encoding</literal> 宣言を用いて
   スキャナにファイル作成時のエンコーディングを伝えます。使用できる値は、
   たとえば <literal>UTF-8</literal> のようなエンコーディング名です。
  </para>
 </sect2>
</sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
