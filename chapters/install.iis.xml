<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision: 1.6 $ -->
<!-- EN-Revision: 1.5 Maintainer: hirokawa Status: ready -->
  <sect1 id="install.iis">
   <title>IIS/PWS サーバ</title>
   <para>
    本節では、PHPをIIS(Microsoft Internet Information Server) にインス
    トールする際の注意およびヒントについて説明します。
    <link linkend="install.iis.iis3">PWS/IIS 3</link>、
    <link linkend="install.iis.pws4">PWS 4 以降</link>、
    <link linkend="install.iis.iis4">IIS 4 以降</link> のバージョンに
    ついて説明します。
   </para>

   <note>
    <title>Important for CGI users</title>
    <para>
     <link linkend="faq.installation.forceredirect">cgi.force_redirectに関するFAQ</link>
     に重要な情報がありますので読んでください。このディレクティブが
     <literal>0</literal>にセットされている必要があります。
    </para>
   </note>

   <sect2 id="install.iis.iis3">
    <title>Windows と PWS/IIS 3</title>
    
    <simpara>
     これらのサーバーを設定するために推奨される方法は、配布ファイルに
     含まれるREGファイル (pws-php4cgi.reg)を使用する方法です。この
     ファイルを編集し、拡張機能および PHP インストールディレクトリを自
     分用の設定に調整することが可能です。さもなくば、以下の手順により、
     手動でこの設定を行うことも可能です。
    </simpara>
    <warning>
     <para>
      これらの手順は、windows レジストリに直接修正します。エラーを一つ
      でも生じた場合、システムの状態が不安定になる可能性があります。ま
      ずレジストリのバックアップをとることを強く推奨します。PHP 開発チー
      ムは、レジストリが損傷した場合の責任を負いません。
     </para>
    </warning>

    <para>
     <itemizedlist>
      <listitem>
       <simpara>
 	Regedit を実行してください。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
 	次の場所に進んでください: <literal>HKEY_LOCAL_MACHINE /System
 	 /CurrentControlSet /Services /W3Svc /Parameters
 	 /ScriptMap</literal>. 
       </simpara>
      </listitem>
      <listitem>
       <simpara>
 	editメニューで次のものを選択してください: 
	<literal>New->String Value</literal>
       </simpara>
      </listitem>
      <listitem>
       <simpara>
 	PHP スクリプトで使用したい拡張子を入力してください。
	例: <literal>.php</literal>
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	新しい文字列値をダブルクリックし、<literal>php.exe</literal>
	へのパスをデータのフィールドに入力してください。例えば、
 	<literal>c:\php\php.exe</literal> となります。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	PHP スクリプトに関連付けたい全ての拡張子に関してこれらの手順を
	繰り返します。
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
    <para>
     以下の手順は、Webサーバのインストールには影響を与えません。
     (<filename>c:\myscripts\test.php</filename>のように) PHPスクリプ
     トをコマンドラインやディレクトリビュアウインドウでPHPスクリプトを
     ダブルクリックして実行したい場合にのみ関係します。PHPファイルをダ
     ブルクリックした際にテキストエディタにロードしたい場合には、以下
     の手順を飛ばしたいと思うかもしれません。
    </para>
    <para>
     <itemizedlist>
      <listitem>
       <simpara>
 	<literal>HKEY_CLASSES_ROOT</literal>に進んでください。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
 	編集メニューから次のものを選んでください: <literal>新規作成->
 	キー</literal>
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	前のセクションで設定した拡張子をキーに入力してください。例:
 	<literal>.php</literal>
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	新規のキーをハイライト表示にし、右側ペーンで、"デフォルト値" を
	ダブルクリックした後、<literal>phpfile</literal> を入力して下
	さい。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	各拡張子に関して先のセクションの設定手順を繰り返してください。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
 	ここで他の <literal>新規作成->キー</literal> を
  	<literal>HKEY_CLASSES_ROOT</literal> のもとに作成し、
 	<literal>phpfile</literal> と名前を付けます。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	新規キー <literal>phpfile</literal> をハイライト表示し、
	右側ペーン上で、"デフォルト値" をダブルクリックし、
 	<literal>PHPスクリプト</literal> を入力します。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	<literal>phpfile</literal> キーを右クリックし、
 	<literal>新規作成->キー</literal> を選択し、
	<literal>Shell</literal> という名前をつけます。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	<literal>Shell</literal> キーを右クリックし、<literal>新規作成-
	>キー</literal> を選択し、<literal>open</literal> という名前を
	つけます。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	<literal>open</literal> キーを右クリックし、
 	<literal>新規作成->キー</literal> を選択し、
	<literal>command</literal> という名前をつけます。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	新規キー <literal>command</literal> をハイライト表示し、
	右側ペーンにて "デフォルト値" をダブルクリックし、
	<literal>php.exe</literal> へのパスを入力します。例:
 	<literal>c:\php\php.exe -q %1</literal>. 
	(<literal>%1</literal>を忘れないでください。)
       </simpara>
      </listitem>
      <listitem>
       <simpara>
 	Regedit を終了してください。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	Windows で PWS を使用した場合、レジストリを再ロードするために
        リブートしてください。
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
    <simpara>
     ここまでの作業で、PWSおよび IIS 3用のシステムインストールは完了します。
     IIS 3 ユーザーは、Steven Genusa が作成したスクリプトマップ設定用の
     すばらしい<ulink url="&url.iiscfg;">ツール</ulink>を使用すること
     ができます。
    </simpara>
    
   </sect2>

   <sect2 id="install.iis.pws4">
    <title>WindowsとPWS 4以降</title>

    <simpara>
     PWS 4以降を実行するWindows上にPHPをインストールする際には、二つの
     方法があります。一つは、PHP CGIバイナリを設定する方法で、もう一つ
     は、ISAPIモジュール dllを使用する方法です。
    </simpara>

    <para>
     CGIバイナリを選択した場合は、次のようにします。
     <itemizedlist>
      <listitem>
       <simpara>
        添付の(sapiディレクトリにある)
        <filename>pws-php4cgi.reg</filename> ファイルを使用するphp.exe
        の位置に合うように編集します。前向きスラッシュは、エスケープす
        る必要があります。例えば、
        <literal>[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\w3svc\parameters\Script Map] ".php"="C:\\php\\php.exe"</literal>
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	PWSマネージャにおいて、PHPサポートを追加したいディレクトリで右
	クリックし、プロパティを選択します。'実行'チェックボックスを
	チェックし、確認します。
       </simpara>
      </listitem>
     </itemizedlist>
    </para>

    <para>
     ISAPIモジュールを選択した場合、次のようにします。
     <itemizedlist>
      <listitem>
       <simpara>
	添付されている<filename>pws-php4isapi.reg</filename>ファイルを
        編集し(sapiディレクトリを参照)、php4isapi.dllの位置をシステム
        にあったものに修正してください。前向きスラッシュはエスケープする
        必要があります。例えば、
        <literal>[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\w3svc\parameters\Script Map] ".php"="C:\\PHP\\sapi\\php4isapi.dll"</literal>
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        PWS マネージャで、PHPサポートを追加したいディレクトリで右クリッ
        クす、プロパティを選択します。「実行」チェックボックスをチェッ
        クし、確認を押します。
       </simpara>
      </listitem>
     </itemizedlist>
    </para>

   </sect2>

   <sect2 id="install.iis.iis4">
    <title>Windows NT/2000/XP と IIS 4 以降</title>

    <simpara>
     PHPをIIS 4以降を実行しているNT/2000/XPサーバ上にインストールするには、
     以下の指示に従ってください。PHPを設定するには、CGIバイナリ(php.exe)
     版とISAPIモジュール版の2種類あります。
    </simpara>
    
    <simpara>
     どちらの場合も、マイクロソフトマネージメントコンソールを起動する
     必要があります。(「インターネットサービスマネージャ」またはNT 4.0
     オプションパックまたはWindows 2000/XPでは、コントロールパネル=&gt;管理ツール
     に現れます。)続いて、Webサーバノード上で右クリック
     (「デフォルトのWebサーバ」としてこれが現れていることが多い)
    </simpara>
    <para>
     CGIバイナリを使用したい場合、次のようにします。
     <itemizedlist>
      <listitem>
       <simpara>
	'ホームディレクトリ'、'仮想ディレクトリ'、'ディレクトリ'の下で'
        設定'ボタンをクリックし、Appマッピングタブに移ります。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        追加をクリックし、実行ボックスで次のように入力します。
        <literal>c:\php\php.exe %s %s</literal> (PHPのzipアーカイブを
        c:\php\で解凍したと仮定します) %s %s を終端に付ける必要があり
        ます。これを行わないと、PHPは正しく機能しません。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        実行ボックスの中で、PHPスクリプトを関連づけるファイル名の拡張
        子を入力してください。'除外メソッド'を空白のままにし、スクリプト
        エンジンチェックボックスをチェックしてください。
        'ファイルの存在をチェックする'をチェックすると、少しパフォーマンス
        は落ちますが、IIS(or PWS)はPHPを起動する前にそのスクリプトが
        存在するか認証上の問題は無いかをチェックします。
        こうすると、PHPが何のデータも出さないCGIエラーよりも
        より読みやすい404エラーメッセージを出力させるようにすることができます。
       </simpara>
       <simpara>
        上記の手順ををPHPスクリプトに関連づけたい拡張毎に繰り返して下
        さい。(<literal>.php</literal> と <literal>.phtml</literal>
        が一般的です。)
       </simpara>
      </listitem>
      <listitem>
       <simpara>
	適切にセキュリティを設定してください。(これは、インターネットセキュ
        リティマネージャにおいて行われます) NTサーバがNTFSファイルシス
        テムを使用している場合、I_USR_に関する実行権限を
	<literal>php.exe</literal> を有するディレクトリに追加して下さ
        い。
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
    
    <para>
     ISAPIモジュールを使用するには、次のようにしてください。
     <itemizedlist>
      <listitem>
       <simpara>
	PHPを使用してHTTP認証を実行したくない場合は、この手順を飛ばす
	ことも可能です(そして、そうするべきです)。ISAPIフィルタの元で
	新規フィルタを追加してください。PHPをフィルタ名として使用し、
	php4isapi.dllへのパスを入力してください。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        'Home Directory'以下で'Configuration'ボタンをクリックして下さ
        い。アプリケーションマネージャへの新規エントリを追加します。
	実行ファイルにphp4isapi.dllへのパスを入力してください。拡張子と
        して .php を指定、除外メソッドは空白のまま、スクリプトエンジン
        チェックボックスをチェックしてください。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        IISを完全に停止 (NET STOP iisadmin)
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        IISを再度開始 (NET START w3svc)
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
   </sect2>
  </sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->