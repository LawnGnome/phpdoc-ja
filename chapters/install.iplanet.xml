<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision: 1.5 $ -->
<!-- EN-Revision: 1.7 Maintainer: hirokawa Status: ready -->
<sect1 id="install.netscape-enterprise">
 <title>Netscape および iPlanet Enterprise サーバ</title>
 <para>
  このセクションでは
  <link linkend="install.netscape.sun">Sun Solaris</link>と
  <link linkend="install.netscape.windows">Windows</link>の両方について、
  PHPをNESまたはiPlanet Webサーバ用に構築する方法についてヒントを述べます。
 </para>
 <para>
  <ulink url="&url.netscape.nsapi;">&url.netscape.nsapi;</ulink>
  にNetscape Enterprise Server(NES)上にPHPをセットアップするための
  より詳細な情報があります。
 </para>
 <sect2 id="install.netscape.sun">
  <title>
   Sun Solaris上にNES/iPlanet/SunONE Webサーバー用のPHPをインストール
   する
  </title>
  <para>
   PHPをNES/iPlanet/SunONE Webサーバ用に構築するには、オプション
   <link linkend="install.configure.with-nsapi">--with-nsapi=[DIR]</link>
   に適当なインストールディレクトリを付けて指定して下さい。
   デフォルトのディレクトリは、通常 <filename
    class="directory">/opt/netscape/suitespot/</filename>です。
   <filename>/php-xxx-version/sapi/nsapi/nsapi-readme.txt</filename>
   も参照下さい。
  </para>
  <para>
   <orderedlist>
    <listitem>
     <para>
      <ulink url="&url.sun.freeware;">&url.sun.freeware;</ulink>
      または他のダウンロードサイトから以下の
      パッケージをダウンロードしインストールします。
      <simplelist>
       <member><filename>autoconf-2.13</filename></member>
       <member><filename>automake-1.4</filename></member>
       <member><filename>bison-1_25-sol26-sparc-local</filename></member>
       <member><filename>flex-2_5_4a-sol26-sparc-local</filename></member>
       <member><filename>gcc-2_95_2-sol26-sparc-local</filename></member>
       <member><filename>gzip-1.2.4-sol26-sparc-local</filename></member>
       <member><filename>m4-1_4-sol26-sparc-local</filename></member>
       <member><filename>make-3_76_1-sol26-sparc-local</filename></member>
       <member>
        <filename>mysql-3.23.24-beta</filename> (if you want mysql support)
       </member>
       <member><filename>perl-5_005_03-sol26-sparc-local</filename></member>
       <member><filename>tar-1.13</filename> (GNU tar)</member>
      </simplelist>
     </para>
    </listitem>
    <listitem>
     <simpara>
      パスが適切に設定され、
      <literal>PATH=.:/usr/local/bin:/usr/sbin:/usr/bin:/usr/ccs/bin</literal>
      が含まれていることを確認して下さい。そして、システム上で
      <userinput>export PATH</userinput>として、有効にしてください。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <userinput>gunzip php-x.x.x.tar.gz</userinput> 
      ( .gz 配布の場合には手順4へ)
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <userinput>tar xvf php-x.x.x.tar</userinput>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      PHPを展開したディレクトリに移動します
      <userinput>cd ../php-x.x.x </userinput>
     </simpara>
    </listitem>
    <listitem>
     <para>
      以下の手順で行ってください。
      <filename class="directory">/opt/netscape/suitespot/</filename>は
      netscapeサーバーをインストールした場所です。
      必要ならパスを変更してください。
      <programlisting role="shell">
<![CDATA[
./configure --with-mysql=/usr/local/mysql \
--with-nsapi=/opt/netscape/suitespot/ \
--enable-libgcc
]]>
      </programlisting>
     </para>
    </listitem>
    <listitem>
     <simpara>
      <command>make</command>の後<command>make install</command>
      を実行してください。
     </simpara>
    </listitem>
   </orderedlist>
  </para>
  <para>
   baseインストールを実行し、適当なreadmeファイルを読んだ後、いくつか
   の追加インストール手順を実行する必要があるかもしれません。
  </para>
  <formalpara>
   <title>NES/iPlanet/SunONEの設定手順</title>
   <para>
    まず、全ての共有ライブラリを見つけるためにSunONE用の環境変数
    LD_LIBRARY_PATH にいくつかのパスを追加する必要があります。これらの
    設定は、SunONE Webサーバの開始スクリプトで行うのが最善でしょう。
    Windows ユーザは、おそらくこの手順をとばすことが可能です。
    開始スクリプトは、通常以下の場所にあります。
    <filename class="directory">/path/to/server/https-servername/start</filename> 
    <filename class="directory">/path/to/server/https-servername/config/</filename>
    にある設定ファイルを編集することも可能です。
    <orderedlist>
     <listitem>
      <para>
       <filename>mime.types</filename>に次の行を追加します。(管理用サー
       バーでこれを行うことができます。)
       <screen>
<![CDATA[
type=magnus-internal/x-httpd-php exts=php
]]>
       </screen>
      </para>
     </listitem>
     <listitem>
      <para>
       <filename>magnus.conf</filename> (サーバー&gt;= 6の場合)または
       <filename>obj.conf</filename>(サーバー&lt; 6の場合) を編集し、
       以下を追加して下さい。
       shlib はシステムにより異なります。使用するOSがUNIXの場合、
       <filename>/opt/netscape/suitespot/bin/libphp4.so</filename>のように
       なるでしょう。
       mime型initの後に次の行を置く必要があります。
       <programlisting>
<![CDATA[
Init fn="load-modules" funcs="php4_init,php4_execute,php4_auth_trans" shlib="/opt/netscape/suitespot/bin/libphp4.so"
Init fn="php4_init" LateInit="yes" errorString="Failed to initialize PHP!" [php_ini="/path/to/php.ini"]
]]>
       </programlisting>
       (PHP &gt;= 4.3.3) <literal>php_ini</literal>パラメータはオプショ
       ンですが、これを指定することにより、Webサーバーの設定ディレクト
       リに&php.ini;を置くことができます。
      </para>
     </listitem>
     <listitem>
      <para>
       <filename>obj.conf</filename>のデフォルトのオブジェクトを設定し
       ます。
       (バーチャルサーバーの場合
       <filename>vserver.obj.conf</filename>の[SunONE 6.0]クラス)
       <programlisting>
<![CDATA[
<object name="default">
.
.
.
.#NOTE この次の行は全ての'ObjectType'の後で、'AddLog'行の前とする必要があります
Service fn="php4_execute" type="magnus-internal/x-httpd-php" [inikey=value inikey=value ...]
    . 
    . 
</Object>
]]>
       </programlisting>
       (PHP &gt;= 4.3.3)
       追加のパラメータとして、いくつかの特別な &php.ini;-値を追加する
       ことができます。例えば、コンテキスト
       <literal>php4_execute</literal>をコールする時に
       <literal>docroot=&quot;/path/to/docroot&quot;</literal> を設定
       することができます。
       論理値の場合、
       <literal>&quot;On&quot;,&quot;Off&quot;,...</literal>(これは正
       しく動作しません)ではなく、0/1を値として使用して下さい。
       例えば、
       <literal>zlib.output_compression=&quot;On&quot;</literal>ではな
       く、<literal>zlib.output_compression=1</literal>となります。
      </para>
     </listitem>
     <listitem>
      <para>
       以下は、(<filename class="directory">cgi-bin</filename>ディレク
       トリのように)PHPスクリプトのみからなるディレクトリを設定したい
       場合のみ必要です。
       <programlisting>
<![CDATA[
<Object name="x-httpd-php"> 
ObjectType fn="force-type" type="magnus-internal/x-httpd-php"
Service fn=php4_execute [inikey=value inikey=value ...]
</Object> 
]]>
       </programlisting>
       これにより、Administrationサーバーの特定のディレクトリを設定し、
       これをスタイル<literal>x-httpd-php</literal>に割り付けることができ
       ます。このディレクトリの中にある全てのファイルはPHPスクリプトと
       して実行されます。
       これは、ファイルの名前を<filename>.html</filename>に変更し、PHP
       が使用されているのを隠す際に有用です。
      </para>
     </listitem>
     <listitem>
      <para>
       認証設定: PHP 認証は他の認証と併用することはできません。
       "全ての認証は、PHPスクリプトに渡されます。"
       サーバ全体についてPHP認証を設定するには、以下の行を追加して下
       さい。
       <programlisting>
<![CDATA[
<Object name="default">
AuthTrans fn=php4_auth_trans
.
.
.
</Object>
]]>
       </programlisting>
      </para>
     </listitem>
     <listitem>
      <para>
       PHP 認証を単一のディレクトリで行うには、次の行を追加します。
       <programlisting>
<![CDATA[
<Object ppath="d:\path\to\authenticated\dir\*"> 
AuthTrans fn=php4_auth_trans 
</Object>
]]>
       </programlisting>
      </para>
     </listitem>
    </orderedlist>
   </para>
  </formalpara>
 </sect2>

 <sect2 id="install.netscape.windows">
  <title>Windows上でNES/iPlanet/SunONにPHPをインストールする</title>
  <para>
   PHPをCGIとしてインストールする場合には以下を行ってください。
   (Netscape Enterprise Server, iPlanet, おそらくFastrackにも)
  </para>
  <itemizedlist>
   <listitem>
    <simpara>
     <filename>php4ts.dll</filename>をシステムルートにコピー
     (Windowsがインストールされているディレクトリ)
    </simpara>
   </listitem>
   <listitem>
    <para>
     コマンドラインからファイルの関連付けを行います。
     次の2行をタイプしてください:
     <programlisting role="shell">
<![CDATA[
assoc .php=PHPScript
ftype PHPScript=c:\php\php.exe %1 %*
]]>
     </programlisting>
    </para>
   </listitem>
   <listitem>
    <simpara>
     Netscape Enterprise Administration Server はダミーのshellcgiディ
     レクトリを作成し、その後すぐに削除します。
     (このステップでは5つの重要な行がobj.confに作成され、
     Webサーバがshellcgiスクリプトを扱えるようになります)
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     Netscape Enterprise Administration Serverにおいて
     新しいmime typeを作成します (Category: type, 
     Content-Type: magnus-internal/shellcgi, File Suffix:php)      
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     PHPを実行する全てのWebサーバーインスタンスで行ってください。
    </simpara>
   </listitem>
  </itemizedlist>
  <para>
   PHPをCGIとしてセットアップするためのより詳細な説明は
   <ulink url="&url.netscape.cgi;">&url.netscape.cgi;</ulink>
   をご覧ください。
  </para>
  <para>
   PHPをNSAPI(Netscape Enterprise Server,
   iPlanet, Fastrack用)としてインストールする場合は
   以下のようにしてください。
  </para>
  <itemizedlist>
   <listitem>
    <simpara>
     <filename>php4ts.dll</filename>をシステムルートにコピー
     (Windowsがインストールされているディレクトリ)
    </simpara>
   </listitem>
   <listitem>
    <para>
     コマンドラインからファイルの関連付けを行います。
     次の2行をタイプしてください:
     <programlisting role="shell">
<![CDATA[
assoc .php=PHPScript
ftype PHPScript=c:\php\php.exe %1 %*
]]>
     </programlisting>
    </para>
   </listitem>
   <listitem>
    <simpara>
     Netscape Enterprise Administration Serverにおいて
     新しいmime typeを作成します (Category: type, 
     Content-Type: magnus-internal/shellcgi, File Suffix:php)      
    </simpara>
   </listitem>
   <listitem>
    <para>
     <filename>magnus.conf</filename> (サーバー&gt;= 6の場合) または
     <filename>obj.conf</filename> (サーバー&lt; 6の場合)を編集し、
     以下を追加して下さい。
     この行を<literal>mime types init</literal>の後に記述する必要があります。
     <programlisting>
<![CDATA[
Init fn="load-modules" funcs="php4_init,php4_execute,php4_auth_trans" shlib="c:/php/sapi/php4nsapi.dll"
Init fn="php4_init" LateInit="yes" errorString="Failed to initialise PHP!" [php_ini="c:/path/to/php.ini"]
]]>
     </programlisting>
     (PHP &gt;= 4.3.3) 
     <literal>php_ini</literal>パラメータはオプションですが、これを指
     定することにより、Webサーバーの設定ディレクトリに
     &php.ini;を置くことができます。
    </para>
   </listitem>
   <listitem>
    <para>
     Configure the default object in 
     <filename>obj.conf</filename>のデフォルトオブジェクトを設定して下
     さい。
     (仮想サーバーの場合、<filename>vserver.obj.conf</filename>のクラ
     ス[SunONE 6.0])
     <literal>&lt; Object name="default" &gt;</literal>セクションに
     次の行を追加してください。この行は、
     'ObjectType'の後、'AddLog'の前に記述して下さい。
     <programlisting>
<![CDATA[
Service fn="php4_execute" type="magnus-internal/x-httpd-php"
]]>
       </programlisting>
     (PHP &gt;= 4.3.3) 
     追加のパラメータとして、いくつかの特別な &php.ini;-値を追加する
     ことができます。例えば、コンテキスト
     <literal>php4_execute</literal>をコールする時に
     <literal>docroot=&quot;/path/to/docroot&quot;</literal> を設定
     することができます。
     論理値の場合、
     <literal>&quot;On&quot;,&quot;Off&quot;,...</literal>(これは正
     しく動作しません)ではなく、0/1を値として使用して下さい。
     例えば、
     <literal>zlib.output_compression=&quot;On&quot;</literal>ではな
     く、<literal>zlib.output_compression=1</literal>となります。
    </para>
   </listitem>
   <listitem>
    <para>
     以下は、(<filename class="directory">cgi-bin</filename>ディレク
     トリのように)PHPスクリプトのみからなるディレクトリを設定したい
     場合のみ必要です。
     <programlisting>
<![CDATA[
<Object name="x-httpd-php">
ObjectType fn="force-type" type="magnus-internal/x-httpd-php"
Service fn=php4_execute [inikey=value inikey=value ...]
</Object>
]]>
     </programlisting>
     これにより、Administrationサーバーの特定のディレクトリを設定し、
     これをスタイル<literal>x-httpd-php</literal>に割り付けることができ
     ます。このディレクトリの中にある全てのファイルはPHPスクリプトと
     して実行されます。
     これは、ファイルの名前を<filename>.html</filename>に変更し、PHP
     が使用されているのを隠す際に有用です。
    </para>
   </listitem>
   <listitem>
    <simpara>
     Webサービスを再起動して設定を反映します
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     PHPを実行する全てのWebサーバーインスタンスで行ってください。
    </simpara>
   </listitem>
  </itemizedlist>
  <para>
   PHPをNSAPIとしてセットアップするためのより詳細な説明は
   <ulink url="&url.netscape.nsapi;">&url.netscape.nsapi;</ulink>
   をご覧ください。
  </para>
 </sect2>

 <sect2 id="install.netscape.specialpages">
  <title>
   エラーページまたは独自のディレクトリリスト用の特別な使用法 (PHP
   &gt;= 4.3.3)
  </title>
  <para>
   You can use PHP to generate the error pages for "404 Not Found"
   or similar. Add the following line to the object in <filename>obj.conf</filename> for
   every error page you want to overwrite:
   <programlisting>
<![CDATA[
Error fn="php4_execute" code=XXX script="/path/to/script.php" [inikey=value inikey=value...]
]]>
   </programlisting>
   where <literal>XXX</literal> ist the HTTP error code. Please delete any other <literal>Error</literal>
   directives which could interfere with yours.
   If you want to place a page for all errors that could exist, leave
   the <literal>code</literal> parameter out. Your script can get the HTTP status code
   with <literal>$_SERVER['ERROR_TYPE']</literal>.
  </para>
  <para>
   Another posibility is to generate self-made directory listings.
   Just create a PHP script which displays a directory listing and
   replace the corresponding default Service line for
   <literal>type=&quot;magnus-internal/directory&quot;</literal> in <filename>obj.conf</filename> with the following:
   <programlisting>
<![CDATA[
Service fn="php4_execute" type="magnus-internal/directory" script="/path/to/script.php" [inikey=value inikey=value...]
]]>
   </programlisting>
   For both error and directory listing pages the original URI and
   translated URI are in the variables <literal>$_SERVER['PATH_INFO']</literal> and
   <literal>$_SERVER['PATH_TRANSLATED']</literal>.
  </para>
 </sect2>

 <sect2 id="install.netscape.notes">
  <title>
   <function>nsapi_virtual</function>およびサブリクエストに関する注意
   (PHP &gt;= 4.3.3)
  </title>
  <para>
   The NSAPI module now supports the <function>nsapi_virtual</function> function
   (alias: <function>virtual</function>)
   to make subrequests on the webserver and insert the result in the webpage.
   The problem is, that this function uses some undocumented features from
   the NSAPI library.
  </para>
  <para>
   Under Unix this is not a problem, because the module automatically looks
   for the needed functions and uses them if available. If not, <function>nsapi_virtual</function>
   is disabled.
  </para>
  <para>
   Under Windows limitations in the DLL handling need the use of a automatic
   detection of the most recent <filename>ns-httpdXX.dll</filename> file. This is tested for servers
   till version 6.0. If a newer version of the SunONE server is used, the detection
   fails and <function>nsapi_virtual</function> is disabled.
  </para>
  <para>
   If this is the case, try the following:
   Add the following parameter to <literal>php4_init</literal> in
   <filename>magnus.conf</filename>/<filename>obj.conf</filename>:
   <programlisting>
<![CDATA[
Init fn=php4_init ... server_lib="ns-httpdXX.dll"
]]>
   </programlisting>
   where <literal>XX</literal> is the correct DLL version number. To get it, look in the server-root
   for the correct DLL name. The DLL with the biggest filesize is the right one.
  </para>
  <para>
   You can check the status by using the <function>phpinfo</function> function.
  </para>
  <note>
   <para>
    But be warned: Support for <function>nsapi_virtual</function> is EXPERIMENTAL!!!
   </para>
  </note>
 </sect2>   
</sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
