 <chapter id="features.safe-mode">
  <title>セーフモード</title>

  <para>
   セーフモードは、共有サーバにおけるセキュリティ上の問題に対する解決策
   です。この問題をPHPのレベルで解決しようするのはアーキテクチャ上正しく
   ありません。しかし、WebサーバやOSのレベルでの代替策はあまり現実的では
   ないため、多くのユーザ、特にISPでは、セーフモードが現在使用されていま
   す。
  </para>
  <para>
   セーフモードを制御する設定ディレクティブには、次のようなものがあります。
   <programlisting role="ini">
safe_mode = Off 
open_basedir = 
safe_mode_exec_dir = 
safe_mode_allowed_env_vars = PHP_ 
safe_mode_protected_env_vars = LD_LIBRARY_PATH 
disable_functions = 
   </programlisting>
  </para>
  <para>
   セーフモードがonの場合、PHPは、現在のスクリプトの所有者がファイル関数に
   より処理されているファイルの所有者に一致するかどうかを調べます。例えば、
   <programlisting role="ls">
-rw-rw-r--    1 rasmus   rasmus       33 Jul  1 19:20 script.php 
-rw-r--r--    1 root     root       1116 May 26 18:01 /etc/passwd 
   </programlisting>
   以下のscript.php を実行すると、
   <programlisting role="php">
&lt;?php
 readfile('/etc/passwd'); 
?&gt;  
   </programlisting>
   セーフモードが有効な場合、以下のようなエラーが出力されます。
   <programlisting role="php">
Warning: SAFE MODE Restriction in effect. The script whose uid is 500 is not 
allowed to access /etc/passwd owned by uid 0 in /docroot/script.php on line 2
   </programlisting>
  </para>
  <para>
   safe_modeの代わりに、open_basedir ディレクトリを設定すると、全ての
   ファイル操作は、指定したディレクトリ以下にあるものに制限されます。
   例を以下に示します。(Apache httpd.ini の例) 
   <programlisting role="ini">
&lt;Directory /docroot&gt; 
php_admin_value open_basedir /docroot 
&lt;/Directory&gt;  
   </programlisting>
   このopen_basedir設定で同じscript.phpを実行した場合、以下のような結果
   となります。
   <programlisting role="php">
Warning: open_basedir restriction in effect. File is in wrong directory in 
/docroot/script.php on line 2 
   </programlisting>
  </para>
  <para>
   個々の関数を無効にすることも可能です。以下の設定をphp.iniファイルに
   追加してみましょう。
   <programlisting role="ini">
disable_functions readfile,system  
   </programlisting>
   この場合、次のような出力となります。
   <programlisting role="php">
Warning: readfile() has been disabled for security reasons in 
/docroot/script.php on line 2 
   </programlisting>
  </para>
 </chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
