<?xml version="1.0" encoding="UTF-8"?>
<!-- EN-Revision: 1.19 Maintainer: haruki Status: ready -->
<!-- CREDITS: fujimoto, hirokawa, yuw, haruki, takagi -->
   <sect1 id="install.windows.manual">
    <title>マニュアルインストール</title>
    
    <para>
     ここからは、Microsoft Windows に手動で PHP をインストールし、Web サーバを
     設定する手順について説明します。
    </para>
    <para>
     始めに、<ulink url="&url.php.downloads;">&url.php.downloads;</ulink>
     のダウンロードページから zip バイナリアーカイブをダウンロードしてください。 
    </para>
    
    <para>
     公式に配布されている Microsoft Window 向けの PHP インストーラを含め
     多数のオールインワンのインストールキットが存在しますが、
     まずは、幾ばくかの時間を割いて独力で PHP をセットアップしてみることをお勧めします。
     そうすることで、システムをより理解することができ、PHP 拡張モジュールの
     インストールも必要に応じて容易にできるようになるでしょう。
    </para>
    
    <note id="install.windows.manual.upgrade">
     <title>前バージョンから PHP をアップグレードする場合</title>
     <para>
      古いバージョンのマニュアルでは、ini ファイルおよび <acronym>DLL</acronym>
      ファイルをシステムフォルダ (<filename class="directory">C:\WINDOWS</filename> など)
      へ移動させることを推奨していました。この移動により、インストール手順は簡単になりますが、
      アップグレードは面倒になっていました。
      新しいバージョンのインストールにあたっては、これら移動させたファイル（システムフォルダ内の
      &php.ini; や PHP 関連の DLLなど）をすべて削除することを推奨します。
      この時システムを壊さないようにするために、バックアップを確実に行ってください。
      古い  &php.ini; は新しい PHP を設定するのに有用です。
      本解説で推奨する PHP のインストール方法は、以下の解説に示すとおり、すべての PHP 関連の
      ファイルをひとつのフォルダにまとめ、システムパスにそのフォルダを登録する方法です。
     </para>
    </note>
    
    <note>
     <title>MDAC 要件</title>
     <para>
      <emphasis>Windows 98/NT4</emphasis> を使用している場合には、
      プラットフォームに合う Microsoft Data Access Components (MDAC) の最新版を
      入手してください。<ulink url="&url.mdac;">&url.mdac;</ulink>
      からダウンロードできます。MDAC が必要な理由は、<link linkend="ref.uodbc">ODBC</link>
      が Windows バイナリにビルトインされているためです。
     </para>
    </note>
    
    <para>
     各サーバ特有の設定を行う前に、以下に示すステップを完了させてください。
    </para>
    <para>
     まず、配布ファイルを適当なフォルダに展開します。PHP4 の場合は、<filename
     class="directory">C:\</filename> がよいでしょう。zip パッケージは
     <filename>php-4.3.7-Win32</filename> のようなフォルダ名で展開されます。
     PHP5 の場合は、PHP4 のようにフォルダ内に展開されないので、<filename
     class="directory">C:\php</filename> 内で解凍してください。
     他の位置に解凍することもできますが、空白を含むパス (例:c:\program files\php)
     にすることはお勧めできません。Web サーバによってはクラッシュを引き起こします。
    </para>
    <para>
     展開されたフォルダの構造は、PHP4 と PHP5 とで異なり、以下のようになります。
    </para>
    <example>
     <title>PHP 4 パッケージ構造</title>
     <programlisting>
<![CDATA[

c:\php
   |
   +--cli
   |  |
   |  |-php.exe           -- CLI 実行ファイル - コマンドラインでのスクリプト実行専用
   |
   +--dlls                -- 拡張モジュールの利用に必要な DLL
   |  |
   |  |-expat.dll
   |  |
   |  |-fdftk.dll
   |  |
   |  |-...
   |
   +--extensions          -- PHP 拡張モジュールの DLL
   |  |
   |  |-php_bz2.dll
   |  |
   |  |-php_cpdf.dll
   |  |
   |  |-..
   |
   +--mibs                -- SNMP 用サポートファイル
   |
   +--openssl             -- Openssl 用サポートファイル
   |
   +--pdf-related         -- PDF 用サポートファイル
   |
   +--sapi                -- SAPI (server module support) DLL
   |  |
   |  |-php4apache.dll
   |  |
   |  |-php4apache2.dll
   |  |
   |  |-..
   |
   +--PEAR                -- PEAR の初期コピー
   |
   |
   |-go-pear.bat          -- PEAR セットアップ用スクリプト
   |
   |-..
   |
   |-php.exe              -- CGI 実行ファイル
   |
   |-..
   |
   |-php.ini-dist         -- デフォルトの php.ini 設定
   |
   |-php.ini-recommended  -- 推奨される php.ini 設定
   | 
   |-php4ts.dll           -- コア PHP DLL
   | 
   |-...

]]>
     </programlisting>
    </example> 
    <para>
    </para>
    <example>
     <title>PHP 5 パッケージ構造</title>
     <programlisting>
<![CDATA[

c:\php
   |
   +--dev
   |  |
   |  |-php5ts.lib
   |
   +--ext                 -- PHP 拡張モジュールの DLL
   |  |
   |  |-php_bz2.dll
   |  |
   |  |-php_cpdf.dll
   |  |
   |  |-..
   |
   +--extras
   |  |
   |  +--mibs             -- SNMP 用サポートファイル
   |  |
   |  +--openssl          -- Openssl 用サポートファイル
   |  |
   |  +--pdf-related      -- PDF 用サポートファイル
   |  |
   |  |-mime.magic
   |
   +--pear                -- PEAR の初期コピー
   |
   |
   |-go-pear.bat          -- PEAR セットアップ用スクリプト
   |
   |-fdftk.dll
   |
   |-..
   |
   |-php-cgi.exe          -- CGI 実行ファイル
   |
   |-php-win.exe          -- コマンドプロンプトを開かずにスクリプトを実行する
   |
   |-php.exe              -- CLI 実行ファイル - コマンドラインでのスクリプト実行専用
   |
   |-..
   |
   |-php.ini-dist         -- デフォルトの php.ini 設定
   |
   |-php.ini-recommended  -- 推奨される php.ini 設定
   | 
   |-php5activescript.dll
   |
   |-php5apache.dll
   |
   |-php5apache2.dll
   |
   |-..
   |
   |-php5ts.dll           -- コア PHP DLL
   | 
   |-...

]]>
     </programlisting>
    </example> 
    <para>
     PHP 4 と PHP 5 とで、相違点もあり、共通点もあります。
     双方とも、<acronym>CGI</acronym> 実行ファイル、<acronym>CLI</acronym>
     実行ファイル、およびサーバモジュールがあります。しかし、フォルダや
     ファイル名が異なります。PHP4 では、サーバモジュールは、
     <filename class="directory">sapi</filename> フォルダ内にありますが、
     PHP 5 ではそういったフォルダは無く、PHP を展開したフォルダのルートにあります。
     PHP 5 の拡張モジュールが必要とする DLL も、別フォルダ内には納められていません。
    </para>
    <note>
     <para>
      PHP 4 では、<filename class="directory">dll</filename> フォルダおよび
      <filename class="directory">sapi</filename> フォルダ内のすべてのファイルを
      メインのフォルダ（<filename class="directory">C:\php</filename> など）に
      移動してください。
     </para>
    </note>
    <para>
     PHP 4 および PHP 5 で提供されているサーバモジュールは以下の通りです。
     <itemizedlist>
      <listitem><para>
       <filename>sapi/php4activescript.dll (php5activescript.dll)</filename>
       - <link linkend="install.windows.activescript">ActiveScript
       エンジン</link>。Windows アプリケーションに PHP を埋め込むことが可能
      </para></listitem>
      <listitem><para>
       <filename>sapi/php4apache.dll (php5apache.dll)</filename> - Apache 1.3.x モジュール
      </para></listitem>
      <listitem><para>
       <filename>sapi/php4apache2.dll (php5apache2.dll)</filename> - Apache 2.0.x モジュール
      </para></listitem>
      <listitem><para>
       <filename>sapi/php4isapi.dll (php5isapi.dll)</filename> - ISAPI モジュール。
       IIS 4.0/PWS 4.0 以降を始とした ISAPI 互換サーバ用
      </para></listitem>
      <listitem><para>
       <filename>sapi/php4nsapi.dll (php5nsapi.dll)</filename> - Sun/iPlanet/Netscape
       用サーバモジュール
      </para></listitem>
      <listitem><para>
       <filename>sapi/php4pi3web.dll (PHP 5 では提供なし)</filename> - Pi3Web 用サーバモジュール
      </para></listitem>
       <!-- TODO: servlets? -->
     </itemizedlist>
    </para>
    <para>
     サーバモジュールは、CGI バイナリと比べ、パフォーマンスが非常に高く、
     機能も追加されています。CLI 版は、PHP をコマンドライン用のスクリプトとして
     使うためのものです。CLI 版について詳しくは <link linkend="features.commandline">PHP
     をコマンドラインから使用する</link>の章を参照してください。
    </para>
    <warning>
     <simpara>
      SAPI モジュールは、バージョン 4.1 以降、顕著な改善が行われています。
      一方、古いシステムにおいては、サーバエラーが発生したり、ASP 等のサーバモジュールが
      落ちたりする可能性があります。
     </simpara>
    </warning>
    <para>
     <acronym>CGI</acronym> バイナリ、<acronym>CLI</acronym>
     バイナリ、およびサーバモジュールのいずれも <filename>php4ts.dll</filename> 
     (<filename>php5ts.dll</filename>) を必要とします。
     PHP がこのファイルを見つけられるようにする必要があります。
     探索順は、以下の通りです。
     <itemizedlist>
      <listitem>
       <para>
        <filename>php.exe</filename> のコール元のフォルダ。SAPI モジュールを
        使用している場合、WEB サーバのフォルダ (例、
        <filename>C:\Program Files\Apache Group\Apache2\bin</filename>)
       </para>
      </listitem>
      <listitem>
       <para>
        Windows の <varname>PATH</varname> 環境変数に登録されたフォルダ
       </para>
      </listitem>
     </itemizedlist>
    </para>
    <para>
     <filename>php4ts.dll</filename> / <filename>php5ts.dll</filename> を有効に
     するには、[1] Windows のシステムフォルダにコピーする方法、
     [2] WEB サーバのフォルダにコピーする方法、[3] PHP フォルダ
     (<filename class="directory">C:\php</filename>) を <varname>PATH</varname>
     環境変数に登録する方法の３つの選択肢があります。メンテナンスを考慮すると、
     ３番目の環境変数に登録する方法をとるべきでしょう。こうすれば、将来の PHP の
     アップグレードが容易になります。PHP フォルダを環境変数に登録する方法に
     ついては、<link linkend="faq.installation.addtopath">FAQ</link> を参照して
     ください (また、コンピュータを再起動することを忘れないでください。
     ログオフするだけでは不十分です)。
    </para>
    <para>
     次のステップは、PHP の設定ファイル &php.ini; を正しく記述することです。 
     配布される zip ファイルには <filename>php.ini-dist</filename> と 
     <filename>php.ini-recommended</filename> の二つの ini ファイルが含まれています。
     パフォーマンスとセキュリティの観点から最適化された初期設定がなされているので、
     <filename>php.ini-recommended</filename> の使用を推奨します。 
     <filename>php.ini-dist</filename> から多くの点で変更が行われています。
     ini ファイルには詳しくコメントが書かれているので、注意深く読んでみると良いでしょう。
     たとえば、<link linkend="ini.display-errors">display_errors</link> や
     <link linkend="ini.magic-quotes-gpc">magic_quotes_gpc</link> が 
     <literal>off</literal> となっていたりします。
     さらに、<link linkend="configuration.file">設定ファイル</link>のセクションもよく読んで 
     各要素を自ら設定してみてください。 
     PHP は、デフォルトの ini ファイルの設定できちんと動作するとはいえ、
     最高のセキュリティを達成したいならば、自ら手を動かして設定することが最善の方法です。
     選んだ ini ファイルを、PHP がアクセスできるフォルダにコピーし、&php.ini; 
     にリネームしてください。PHP は、<xref linkend="configuration.file"/>
     の節で述べられている場所から &php.ini; を探します。
    </para>
    <para>
     Apache 2 を使用する場合、PHPIniDir ディレクティブを使うのが最も簡単でしょう
     (<link linkend="install.windows.apache2">Apache 2 へのインストール</link> ページ参照。)
     他の場合、<varname>PHPRC</varname> 環境変数を設定するのが良いでしょう。
     詳しい方法については、こちらの <link linkend="faq.installation.phprc">FAQ エントリ</link> で解説されています。
    </para>
    <note>
     <simpara>
      Windows NT, 2000, XP または 2003 で NTFS を使用している場合、WEB サーバを
      実行するユーザが、&php.ini; を読める権限があることを確認してください。
     </simpara>
    </note>
    <para>
      以下のステップは、必要に応じて行ってください。
     <itemizedlist>
      <listitem>
       <para>
        &php.ini; ファイルを編集し、 
        <link linkend="ini.doc-root">doc_root</link> に Web サーバーの
        ドキュメントルートを設定します（ただし、OmniHTTPd を使用する場合は編集しないこと。）
        例えば、以下のように設定します。
        <informalexample>
          <programlisting role="ini">
<![CDATA[
doc_root = c:\inetpub       // IIS/PWS の場合

doc_root = c:\apache\htdocs // Apache の場合 
]]>
         </programlisting>
        </informalexample>
       </para>
      </listitem>
      <listitem>
       <simpara>
        PHP の起動時に、必要な拡張モジュールがロードされるように設定します。セットアップの方法や、
        ビルトイン済みのモジュールについては
        <link linkend="install.windows.extensions">Windows 用拡張モジュール</link> のセクションを
        参照してください。PHP の新規インストールの場合は、まず PHP が拡張モジュールなしで正しく動作することを
        確認してから、php.ini を変更して拡張モジュールを有効にするほうが賢明です。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        PWS と IIS においては、<link linkend="ini.browscap">browscap</link>
        を 次のように指定することができます。
        <filename>c:\windows\system\inetsrv\browscap.ini</filename> 
        (Windows 9x/Me の場合)、
        <filename>c:\winnt\system32\inetsrv\browscap.ini</filename> 
        (NT/2000 の場合)、
        <filename>c:\windows\system32\inetsrv\browscap.ini</filename>
        (XP の場合)。  
        <filename>browscap.ini</filename> の編集については、
        <link linkend="faq.obtaining.browscap">FAQ</link> を参照してください。
       </simpara>
      </listitem>
     </itemizedlist>
    </para> 
    <para>
     以上で、Windows への PHP のインストールが完了しました。ついで、
     使用する WEB サーバ にあわせて、PHP を利用可能とするための設定を行います。
     目次から使用する WEB サーバを選択し、該当するセクションを参照してください。
    </para>
   </sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
