<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision: 1.5 $ -->
<!-- EN-Revision: 1.19 Maintainer: hirokawa Status: ready -->
<!-- CREDITS: takagi -->

<refentry id="function.fsockopen">
 <refnamediv>
  <refname>fsockopen</refname>
  <refpurpose>
   インターネットもしくはUNIXドメインのソケット接続をオープンする
  </refpurpose> 
 </refnamediv>
 <refsect1>
  <title>説明</title>
  <methodsynopsis>
   <type>resource</type><methodname>fsockopen</methodname>
   <methodparam><type>string</type><parameter>target</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>port</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter role="reference">errno</parameter></methodparam>
   <methodparam choice="opt"><type>string</type><parameter role="reference">errstr</parameter></methodparam>
   <methodparam choice="opt"><type>float</type><parameter>timeout</parameter></methodparam>
  </methodsynopsis>
  <para>
   <parameter>target</parameter>に指定されたリソースへのソケット接続を初期化します。
   PHPは<xref linkend="transports"/>に記述されているように
   Internetドメインまたは Unixドメインの中のターゲットをサポートします。
   サポートされるトランスポートのリストは、<function>stream_get_transports</function>
   を使って取得することもできます。
  </para>
  <note>
   <simpara>
    ソケット経由でデータを読み書きする際のタイムアウトを設定する必要がある場合、
    <function>fsockopen</function> の <parameter>timeout</parameter> パラメータは、
    ソケットに接続する間にだけ適用されるため、
    <function>socket_set_timeout</function>を使用してください。
   </simpara>
  </note>
  <para>
   PHP 4.3.0以降、OpenSSLサポートを有効にしてコンパイルした場合、
   <parameter>hostname</parameter>の前に'<literal>ssl://</literal>' または
   '<literal>tls://</literal>' を付加することにより、TCP/IP経由でリモートホストに
   接続する際にSSLまたはTLSクライアント接続を使用することができます。
  </para>
  <para>
   <function>fsockopen</function>は、ファイルポインタを返します。
   このファイルポインタは、
   (<function>fgets</function>,<function>fgetss</function>,
   <function>fputs</function>, <function>fclose</function>,
   <function>feof</function>のような)
   他のファイル関数で使用可能です。
  </para>
  <para>
   コールに失敗した場合には&false;が返され、オプションの引数
   <parameter>errno</parameter>および<parameter>errstr</parameter>
   が指定されている場合、システムコール<literal>connect()</literal>
   で生じた実際のシステムレベルエラーを示すように設定されます。
   <parameter>errno</parameter>は<literal>0</literal>なのに関数が
   &false;を返す場合、<literal>connect()</literal>
   をコールする前にエラーを発生したことを示します。
   この場合、おそらくはソケットの初期化に原因があります。引数
   <parameter>errno</parameter> および <parameter>errstr</parameter>
   は常に参照渡しであることに注意してください。
  </para>
  <para>
   環境によってはUNIXドメインまたはオプションの接続タイムアウトは利用
   できません。
  </para>
  <para>
   ソケットはデフォルトでブロックモードで開かれます。
   <function>socket_set_blocking</function>を使用して、
   非ブロックモードに切換えることができます。
   <example>
    <title><function>fsockopen</function>の例</title>
    <programlisting role="php">
<![CDATA[
<?php
$fp = fsockopen("www.example.com", 80, $errno, $errstr, 30);
if (!$fp) {
    echo "$errstr ($errno)<br />\n";
} else {
    $out = "GET / HTTP/1.1\r\n";
    $out .= "Host: www.example.com\r\n";
    $out .= "Connection: Close\r\n\r\n";

    fwrite($fp, $out);
    while (!feof($fp)) {
        echo fgets($fp, 128);
    }
    fclose($fp);
}
?>
]]>
    </programlisting>
   </example>
   以下の例は、自分のマシンのUDPサービス "daytime" (ポート13)から日
   付と時間を取得する方法を示すものです。
   <example>
    <title>UDP接続の使用法</title>
    <programlisting role="php">
<![CDATA[
<?php
$fp = fsockopen("udp://127.0.0.1", 13, $errno, $errstr);
if (!$fp) {
    echo "ERROR: $errno - $errstr<br />\n";
} else {
    fwrite($fp, "\n");
    echo fread($fp, 26);
    fclose($fp);
}
?>
]]>
    </programlisting>
   </example>
   <warning>
    <simpara>
     UDPソケットは、リモートホストとの接続が確立されていない場合でも、
     エラーを発生せずにオープンされたように見えることが時々あります。
     このエラーは、そのソケットでデータを読み書きした際にのみ明らかに
     なります。この原因は、UDPが"コネクションレス"のプロトコルであり、
     実際にデータを送受信する必要が生じるまで、オペレーションシステムが
     ソケット用のリンクを確立しようとしないためです。
    </simpara>
   </warning>
   <note>
    <para>
     <parameter>timeout</parameter> は PHP 3.0.9 でサポートされまし
     た。また、UDP のサポートは PHP 4で追加されました。
    </para>
   </note>
   <function>pfsockopen</function>,
   <function>socket_set_blocking</function>,
   <function>socket_set_timeout</function>, <function>fgets</function>,
   <function>fgetss</function>, <function>fputs</function>,
   <function>fclose</function>, <function>feof</function>,
   <link linkend="ref.curl">Curl拡張モジュール</link> も参照ください。
  </para>
 </refsect1>
</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
