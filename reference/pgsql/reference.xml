<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision: 1.2 $ -->
 <reference id="ref.pgsql">
  <title>PostgreSQL 関数</title>
  <titleabbrev>PostgreSQL</titleabbrev>

  <partintro>
   <warning>
    <para>
     PHP 4.0.6の通知メッセージ処理にはバグがあるため、PHP 4.0.6で
     PostgreSQLモジュールを使用することは推奨されません。
    </para>
   </warning>
   <warning>
    <para>
     PostgreSQLの関数名は、現在のコード規約に沿うようにバージョン4.2.0
     で変更されます。新しい名前の多くにはアンダースコアが追加されます。
     例えば、pg_exec()からpg_query()のようにいくつかの関数は、統一性を
     持たせるために異なる名前に変更されます。以前の名前は、4.2.0以降の
     何回かのリリースでも使用可能ですが、将来的に削除される可能性があ
     ります。CVSバージョンには、新しい関数名が付けられています。
    </para>
    <example>
     <title>関数名の変更</title>
     <programlisting role="php">
<![CDATA[
OLD NAME           NEW NAME
pg_exec            pg_query
getlastoid         pg_last_oid
pg_cmdtuples       pg_affected_rows
pg_errormessage    pg_last_error
pg_numrows         pg_num_rows
pg_numfields       pg_num_fields
pg_fieldname       pg_field_name
pg_fieldsize       pg_field_size
pg_fieldtype       pg_field_type
pg_fieldnum        pg_field_num
pg_fieldprtlen     pg_field_prtlen
pg_fieldisnull     pg_field_is_null
pg_freeresult      pg_free_result
pg_result          pg_fetch_result
pg_loreadall       pg_lo_read_all
pg_locreate        pg_lo_create
pg_lounlink        pg_lo_unlink
pg_loopen          pg_lo_open
pg_loclose         pg_lo_close
pg_loread          pg_lo_read
pg_lowrite         pg_lo_write
pg_loimport        pg_lo_import
pg_loexport        pg_lo_export
]]>
     </programlisting>
    </example>
    <para>
     従来のpg_connect()/pg_pconnect() は、将来的に同期接続機能をサポー
     トするために過去のものとなる可能性があります。
    </para>
   </warning>
   <para>
    Postgresは元々UCB(カリフォルニア大学バークレイ校)コンピュータ・サ
    イエンス学部で開発されたものです。このPostgresは、いくつかの商用デー
    タベースにおいてサポートされつつあるオブジェクトリレーショナルデー
    タベース的概念の多くの先駆けでした。PostgreSQLは、SQL92/SQL3言語サ
    ポート、トランザクション機能、拡張可能な型を提供しています。
    PostgreSQLは、パブリック・ドメイン、オープンソースで、オリジナルの
    バークレイ・コードから発展してきた子孫にあたります。
   </para>
   <para>
    PostgreSQLデータベースはオープンソースのプロダクツであり、無料で使
    用可能できます。PostgreSQLサポートを使用するには、PostgreSQL 6.5以
    降が必要です。PostgreSQL 7.0以降ではPostgreSQLモジュールの全ての機
    能が使用可能です。PostgreSQLは、マルチバイト文字エンコーディングを
    含む多くの文字エンコーディングをサポートしています。現在のバージョ
    ン及びPostgreSQLに関するより詳細な情報は、<ulink
    url="&url.pgsql;">www.postgresqlL.org</ulink>で入手可能です。
   </para>
   <para>
    PostgreSQLサポートを利用可能とするには、PHPコンパイル時に
    &quot;--enable-pgsql[=DIR]&quot; を指定することが必要です。共有オ
    ブジェクトモジュールが利用可能な場合、PostgreSQLはphp.iniの
    <link linkend="ini.extension">extension</link>または
    <function>dl</function>関数を使用してロードすることが可能です。
    サポートされるini命令は、配布ソースに付属するphp.ini-distファイル
    に記述されています。
   </para>
   <para>
    全ての関数が全ての構築環境でサポートされるわけではありません。サポー
    トされる関数は、使用するlibpq(PostgreSQLのCクライアントインターフェ
    イス)のバージョンとlibpqのコンパイル方法に依存します。足りない関数
    がある場合、libpqはその関数を必要とする機能をサポートしません。
   </para>
   <para>
    接続するPostgreSQLサーバーよりも新しいlibpqを使用することも重要で
    す。使用するlibpqのバージョンがPostgreSQLサーバが期待するよりも古
    い場合、問題を生じる可能性があります。
   </para>
   <para>
    バージョン6.3(1998/3/2)以降、PostgreSQLはUNIXドメインソケットを
    使用しています。これらの新しいコネクションの使用例を以下に示す表に
    示します。このソケットは<filename>/tmp/.s.PGSQL.5432</filename>にあります。
    このオプションは<command>postmaster</command>に対して'-i'フラグを
    指定することで有効となります。これは "Unixドメインソケット以外のTCP/IP
    ソケットもlisten する"という意味です。
    <table>
     <title>postmasterとPHP</title>
     <tgroup cols="3">
      <thead>
       <row>
	<entry>postmaster</entry>
	<entry>PHP</entry>
	<entry>ステータス</entry>
       </row>
      </thead>
      <tbody>
       <row>
	<entry>postmaster &amp;</entry>
	<entry>pg_connect("dbname=MyDbName");</entry>
	<entry>OK</entry>
       </row>
       <row>
	<entry>postmaster -i &amp;</entry>
<!--	<entry>pg_connect("", "", "", "", "dbname");</entry> -->
	<entry>pg_connect("dbname=MyDbName");</entry>
	<entry>OK</entry>
       </row>
       <row>
	<entry>postmaster &amp;</entry>
	<entry>pg_connect("host=localhost dbname=MyDbName");</entry>
	<entry>
	 Unable to connect to PostgreSQL server: connectDB() failed: 
	 Is the postmaster running and accepting TCP/IP (with -i) 
	 connection at 'localhost' on port '5432'? in 
	 /path/to/file.php3 on line 20.
	</entry>
       </row>
       <row>
	<entry>postmaster -i &amp;</entry>
	<entry>pg_connect("host=localhost dbname=MyDbName");</entry>
	<entry>OK</entry>
       </row>
      </tbody>
     </tgroup>
    </table>
   </para>
   <para>
    次のコマンドでも接続を確立することができます。
    <command>$conn = pg_Connect("host=myHost port=myPort tty=myTTY
    options=myOptions dbname=myDB user=myUser password=myPassword");
    </command>
   </para>
   <para>
    以前の構文:
    <command>
     $conn = pg_connect ("host", "port", "options", "tty", "dbname")
    </command>
    は推奨されません。
   </para>
   <para>
    環境変数は、PostgreSQLサーバ/クライアントの動作に影響を与えます。
    例えば、PostgreSQLモジュールは、ホスト名が接続文字列で省略された場
    合、環境変数PGHOSTを探します。サポートされる環境変数は、バージョン
    毎に異なります。詳細は、PostgreSQLプログラマ用マニュアル(libpq -
    環境変数)を参照下さい。
   </para>
   <para>
    PostgreSQL 7.1.0から、textデータ型の最大サイズは1GBとなっています。
    古いPostgreSQLのtextデータ型はブロックサイズ(デフォルトは8KB、最大
    32KBをコンパイル時に定義可能)の制限を受けていました。
   </para>
   <para>
    ラージオブジェクト(lo)インターフェースを使用するには、そのクエリーを
    トランザクション・ブロックの中に入れてやる必要があります。
    トランザクション・ブロックは<command>begin</command>で始まり、
    そのトランザクションが有効な場合は<command>commit</command>または
    <command>end</command>で終わります。トランザクションが失敗した場合、
    そのトランザクションは<command>rollback</command>または
    <command>abort</command>により閉じる必要があります。
    <example>
     <title>ラージオブジェクトの使用例</title>
     <programlisting role="php">
<![CDATA[
<?php
   $database = pg_connect ("dbname=jacarta");
    pg_exec ($database, "begin");
    $oid = pg_locreate ($database);
    echo ("$oid\n");
    $handle = pg_loopen ($database, $oid, "w");
    echo ("$handle\n");
    pg_lowrite ($handle, "large object data");
    pg_loclose ($handle);
    pg_exec ($database, "commit");
?>
]]>
     </programlisting>
    </example>
    ラージオブジェクトリソースを閉じる前に接続リソースを閉じないように
    して下さい。
   </para>
  </partintro>

&reference.pgsql.functions;

 </reference>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->

